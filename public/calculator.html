<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TI-30XIIS Calculator</title>
    <link rel="stylesheet" href="/css/calculator.css">
</head>
<body class="standalone-calculator-page">
    <div class="calculator-container" id="calculator-container">
        <div class="calculator" id="calculator-main">
            <!-- Resize Handle (bottom-right corner) -->
            <div class="resize-handle" id="resize-handle" title="Drag to resize">
                <svg width="20" height="20" viewBox="0 0 20 20">
                    <path d="M19 19L19 13M19 19L13 19M19 19L11 11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    <path d="M19 7L7 19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
            </div>

            <!-- Scale Indicator -->
            <div class="scale-indicator" id="scale-indicator">100%</div>
            <!-- Calculator Header -->
            <div class="calculator-header">
                <div class="brand">TEXAS INSTRUMENTS</div>
                <div class="model">TI-30XIIS</div>
            </div>

            <!-- Display -->
            <div class="display-container">
                <div class="display-indicators">
                    <span id="angle-mode">DEG</span>
                    <span id="hyp-indicator"></span>
                    <span id="memory-indicator"></span>
                </div>
                <div class="display">
                    <div class="display-line" id="input-line"></div>
                    <div class="display-line result-line" id="result-line">0</div>
                </div>
            </div>

            <!-- Buttons -->
            <div class="buttons">
                <!-- Row 1 + Arrow Keys (right side, rows 1-2) -->
                <button class="btn btn-function" data-action="2nd">2nd</button>
                <button class="btn btn-function" data-action="mode">
                    <span class="secondary">sci/eng</span>
                    <span class="primary">DRG</span>
                </button>
                <button class="btn btn-function" data-action="del">
                    <span class="secondary">ins</span>
                    <span class="primary">DEL</span>
                </button>
                <div class="arrow-placeholder"></div>
                <button class="btn btn-arrow" data-action="arrow-up">⬆</button>
                <div class="arrow-placeholder"></div>

                <!-- Row 2 + Arrow Keys -->
                <button class="btn btn-function" data-fn="log" data-fn2="pow10">
                    <span class="secondary">10ˣ</span>
                    <span class="primary">LOG</span>
                </button>
                <button class="btn btn-function" data-fn="prb" data-fn2="fd">
                    <span class="secondary">F⇔D</span>
                    <span class="primary">PRB</span>
                </button>
                <button class="btn btn-function" data-fn="polar">
                    <span class="secondary">R⇔P</span>
                    <span class="primary">.'ʺ</span>
                </button>
                <button class="btn btn-arrow" data-action="arrow-left">⬅</button>
                <button class="btn btn-arrow" data-action="arrow-down">⬇</button>
                <button class="btn btn-arrow" data-action="arrow-right">➡</button>

                <!-- Row 3 -->
                <button class="btn btn-function" data-fn="ln" data-fn2="exp">
                    <span class="secondary">eˣ</span>
                    <span class="primary">LN</span>
                </button>
                <button class="btn btn-function" data-fn="abc">
                    <span class="secondary">Ab/c⇔d/e</span>
                    <span class="primary">Ab/c</span>
                </button>
                <button class="btn btn-function" data-action="data">
                    <span class="secondary">STAT</span>
                    <span class="primary">DATA</span>
                </button>
                <button class="btn btn-function" data-action="statvar">
                    <span class="secondary">EXIT STAT</span>
                    <span class="primary">STAT VAR</span>
                </button>
                <button class="btn btn-clear" data-action="clear">CLEAR</button>
                <div class="button-spacer"></div>

                <!-- Row 4 -->
                <button class="btn btn-function" data-fn="pi" data-fn2="hyp">
                    <span class="secondary">HYP</span>
                    <span class="primary">π</span>
                </button>
                <button class="btn btn-function" data-fn="sin" data-fn2="asin">
                    <span class="secondary">SIN⁻¹</span>
                    <span class="primary">SIN</span>
                </button>
                <button class="btn btn-function" data-fn="cos" data-fn2="acos">
                    <span class="secondary">COS⁻¹</span>
                    <span class="primary">COS</span>
                </button>
                <button class="btn btn-function" data-fn="tan" data-fn2="atan">
                    <span class="secondary">TAN⁻¹</span>
                    <span class="primary">TAN</span>
                </button>
                <button class="btn btn-operator" data-op="÷">÷</button>
                <div class="button-spacer"></div>

                <!-- Row 5 -->
                <button class="btn btn-function" data-fn="power" data-fn2="nthroot">
                    <span class="secondary">ⁿ√</span>
                    <span class="primary">^</span>
                </button>
                <button class="btn btn-function" data-fn="reciprocal" data-fn2="ee">
                    <span class="secondary">EE</span>
                    <span class="primary">x⁻¹</span>
                </button>
                <button class="btn btn-function" data-fn="lparen" data-fn2="percent">
                    <span class="secondary">%</span>
                    <span class="primary">(</span>
                </button>
                <button class="btn btn-function" data-fn="rparen" data-fn2="comma">
                    <span class="secondary">,</span>
                    <span class="primary">)</span>
                </button>
                <button class="btn btn-operator" data-op="×">×</button>
                <div class="button-spacer"></div>

                <!-- Row 6 -->
                <button class="btn btn-function" data-fn="square" data-fn2="sqrt">
                    <span class="secondary">√</span>
                    <span class="primary">x²</span>
                </button>
                <button class="btn btn-number" data-num="7">7</button>
                <button class="btn btn-number" data-num="8">8</button>
                <button class="btn btn-number" data-num="9">9</button>
                <button class="btn btn-operator" data-op="−">−</button>
                <div class="button-spacer"></div>

                <!-- Row 7 -->
                <button class="btn btn-function" data-fn="rcl">
                    <span class="primary">RCL</span>
                </button>
                <button class="btn btn-number" data-num="4">4</button>
                <button class="btn btn-number" data-num="5">5</button>
                <button class="btn btn-number" data-num="6">6</button>
                <button class="btn btn-operator" data-op="+">+</button>
                <div class="button-spacer"></div>

                <!-- Row 8 -->
                <button class="btn btn-function" data-fn="sto" data-fn2="rcl">
                    <span class="secondary">RCL</span>
                    <span class="primary">STO→</span>
                </button>
                <button class="btn btn-number" data-num="1">1</button>
                <button class="btn btn-number" data-num="2">2</button>
                <button class="btn btn-number" data-num="3">3</button>
                <button class="btn btn-enter btn-enter-tall" data-action="enter">
                    <span>=</span>
                    <span>ENTER</span>
                </button>
                <div class="button-spacer"></div>

                <!-- Row 9 -->
                <button class="btn btn-function" data-action="on">ON</button>
                <button class="btn btn-number" data-num="0">0</button>
                <button class="btn btn-function" data-fn="decimal">.</button>
                <button class="btn btn-function" data-fn="negative">(-)</button>
                <div class="button-spacer"></div>
                <div class="button-spacer"></div>
            </div>

            <!-- Solar Panel -->
            <div class="solar-panel"></div>
        </div>
    </div>

    <script src="/js/calculator.js"></script>
    <script>
        // Calculator Drag-to-Resize Functionality
        (function() {
            const container = document.getElementById('calculator-container');
            const resizeHandle = document.getElementById('resize-handle');
            const scaleIndicator = document.getElementById('scale-indicator');

            let currentScale = 1.0;
            const minScale = 0.4;
            const maxScale = 1.5;

            let isDragging = false;
            let startX = 0;
            let startY = 0;
            let startScale = 1.0;

            // Calculate optimal initial scale to fit viewport
            function calculateOptimalScale() {
                const viewportHeight = window.innerHeight;
                const viewportWidth = window.innerWidth;
                const calcHeight = 680;
                const calcWidth = 430;
                const heightScale = (viewportHeight * 0.9) / calcHeight;
                const widthScale = (viewportWidth * 0.9) / calcWidth;
                return Math.max(Math.min(heightScale, widthScale, maxScale), minScale);
            }

            function updateScale(scale, showIndicator = false) {
                currentScale = Math.max(minScale, Math.min(maxScale, scale));
                container.style.transform = `scale(${currentScale})`;
                scaleIndicator.textContent = `${Math.round(currentScale * 100)}%`;

                if (showIndicator) {
                    scaleIndicator.classList.add('visible');
                }
            }

            function hideIndicator() {
                scaleIndicator.classList.remove('visible');
            }

            // Drag to resize
            resizeHandle.addEventListener('mousedown', (e) => {
                e.preventDefault();
                isDragging = true;
                startX = e.clientX;
                startY = e.clientY;
                startScale = currentScale;

                scaleIndicator.classList.add('visible');
                resizeHandle.style.color = 'rgba(255, 255, 255, 1)';

                document.body.style.cursor = 'nwse-resize';
            });

            document.addEventListener('mousemove', (e) => {
                if (!isDragging) return;

                // Calculate distance from start point
                const deltaX = e.clientX - startX;
                const deltaY = e.clientY - startY;

                // Use diagonal distance (average of x and y movement)
                const avgDelta = (deltaX + deltaY) / 2;

                // Convert pixel movement to scale change
                // Roughly 100px drag = 0.2 scale change
                const scaleChange = avgDelta / 500;
                const newScale = startScale + scaleChange;

                updateScale(newScale, true);
            });

            document.addEventListener('mouseup', () => {
                if (isDragging) {
                    isDragging = false;
                    document.body.style.cursor = '';
                    resizeHandle.style.color = '';

                    setTimeout(hideIndicator, 1000);
                }
            });

            // Touch support for mobile
            resizeHandle.addEventListener('touchstart', (e) => {
                e.preventDefault();
                const touch = e.touches[0];
                isDragging = true;
                startX = touch.clientX;
                startY = touch.clientY;
                startScale = currentScale;
                scaleIndicator.classList.add('visible');
            });

            document.addEventListener('touchmove', (e) => {
                if (!isDragging) return;
                const touch = e.touches[0];
                const deltaX = touch.clientX - startX;
                const deltaY = touch.clientY - startY;
                const avgDelta = (deltaX + deltaY) / 2;
                const scaleChange = avgDelta / 500;
                const newScale = startScale + scaleChange;
                updateScale(newScale, true);
            });

            document.addEventListener('touchend', () => {
                if (isDragging) {
                    isDragging = false;
                    setTimeout(hideIndicator, 1000);
                }
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    if (e.key === '=' || e.key === '+') {
                        e.preventDefault();
                        updateScale(currentScale + 0.1, true);
                        setTimeout(hideIndicator, 1000);
                    } else if (e.key === '-') {
                        e.preventDefault();
                        updateScale(currentScale - 0.1, true);
                        setTimeout(hideIndicator, 1000);
                    } else if (e.key === '0') {
                        e.preventDefault();
                        updateScale(1.0, true);
                        setTimeout(hideIndicator, 1000);
                    }
                }
            });

            // Mouse wheel zoom (bonus feature)
            container.addEventListener('wheel', (e) => {
                if (e.ctrlKey || e.metaKey) {
                    e.preventDefault();
                    const delta = -Math.sign(e.deltaY) * 0.05;
                    updateScale(currentScale + delta, true);

                    clearTimeout(container.wheelTimeout);
                    container.wheelTimeout = setTimeout(hideIndicator, 1000);
                }
            }, { passive: false });

            // Window resize handler
            let resizeTimeout;
            window.addEventListener('resize', () => {
                clearTimeout(resizeTimeout);
                resizeTimeout = setTimeout(() => {
                    const newOptimalScale = calculateOptimalScale();
                    if (currentScale > newOptimalScale) {
                        updateScale(newOptimalScale);
                    }
                }, 150);
            });

            // Initialize
            const initialScale = calculateOptimalScale();
            updateScale(initialScale);
        })();
    </script>
</body>
</html>
