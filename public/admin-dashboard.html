<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Admin Dashboard - M∆THM∆TIΧ AI</title>
  <link rel="stylesheet" href="/style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body class="landing-page-body">

  <header class="landing-header">
    <div class="header-logo-container">
      <img src="/images/mathmatix-ai-logo.png" alt="Mathmatix AI Logo" class="main-logo-hero" />
    </div>
    <nav class="landing-nav">
      <h1>Admin Dashboard</h1>
      <button id="logoutBtn" class="btn btn-tertiary logout-button">Log Out</button>
    </nav>
  </header>

  <main class="admin-page-wrapper">
    <div class="admin-main-content">

      <div class="admin-widget-sidebar">
        <div class="dashboard-panel card-style-1">
          <div class="dashboard-panel-header">System Status</div>
          <p>Database: <span id="dbStatus" class="status-online">Online</span></p>
          <p>AI Service: <span id="aiStatus" class="status-online">Operational</span></p>
          <p>Last Sync: <span id="lastSyncTime">Just now</span></p>
        </div>
        <div class="dashboard-panel card-style-1">
          <div class="dashboard-panel-header">Top Students</div>
          <div class="table-scroll-container">
            <table id="leaderboardTable" class="user-table">
              <thead>
                <tr>
                  <th>Rank</th>
                  <th>Name</th>
                  <th>Level</th>
                  <th>XP</th>
                </tr>
              </thead>
              <tbody>
                <tr><td colspan="4" style="text-align:center;">Loading...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="admin-central-content">
        <div class="dashboard-panel controls card-style-1">
          <div class="dashboard-panel-header">Teacher Assignment</div>
          <div class="form-group">
            <label for="teacherSelect">Assign selected students to:</label>
            <select id="teacherSelect"></select>
          </div>
          <button id="assignButton" class="submit-btn btn-primary">Assign</button>
        </div>

        <div class="dashboard-panel card-style-1">
          <div class="dashboard-panel-header">Student List</div>
          <div class="form-group">
            <input type="text" id="studentSearch" placeholder="Search students by name or email..." />
          </div>
          <div class="table-scroll-container">
            <table class="user-table">
              <thead>
                <tr>
                  <th><input type="checkbox" id="selectAllCheckbox" title="Select All"></th>
                  <th>Name</th>
                  <th>Email</th>
                  <th>Role</th>
                  <th>Current Teacher</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="userTableBody">
                <tr><td colspan="6" style="text-align:center;">Loading students...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="admin-widget-sidebar">
        <div class="dashboard-panel card-style-1">
          <div class="dashboard-panel-header">User Summaries Access</div>
          <p>Quickly view detailed student and parent profiles.</p>
          <button id="openSummariesBtn" class="main-action-btn btn btn-secondary">
            <i class="fas fa-list-alt"></i> View All Summaries
          </button>
        </div>
        <div class="dashboard-panel card-style-1">
          <div class="dashboard-panel-header">Quick Reports</div>
          <p>View comprehensive usage and activity reports.</p>
          <button id="openUsageReportBtn" class="main-action-btn btn btn-secondary">
            <i class="fas fa-chart-bar"></i> Usage Report
          </button>
          <button id="openLiveActivityBtn" class="main-action-btn btn btn-secondary" style="margin-top: 10px;">
            <i class="fas fa-broadcast-tower"></i> Live Activity
          </button>
        </div>
      </div>
    </div>
  </main>

  <footer>
    <p>&copy; 2025 M∆THM∆TIΧ AI. All rights reserved.</p>
    <p><a href="/privacy.html">Privacy Policy</a> | <a href="/terms.html">Terms of Use</a></p>
  </footer>

  <div id="studentDetailModal" class="modal-overlay">
    <div class="modal-content">
      <button class="modal-close-button" id="closeModalButton">&times;</button>
      <h2 id="modalStudentName">Student Profile</h2>

      <div class="modal-section">
        <h3>General Information</h3>
        <form id="studentProfileForm">
          <input type="hidden" id="modalStudentId">
          <div class="modal-form-group"><label for="firstName">First Name:</label><input type="text" id="firstName" name="firstName"></div>
          <div class="modal-form-group"><label for="lastName">Last Name:</label><input type="text" id="lastName" name="lastName"></div>
          <div class="modal-form-group"><label for="username">Username:</label><input type="text" id="username" name="username" readonly></div>
          <div class="modal-form-group"><label for="email">Email:</label><input type="email" id="email" name="email"></div>
          <div class="modal-form-group"><label for="gradeLevel">Grade Level:</label><input type="text" id="gradeLevel" name="gradeLevel"></div>
          <div class="modal-form-group"><label for="mathCourse">Math Course:</label><input type="text" id="mathCourse" name="mathCourse"></div>
          <div class="modal-form-group"><label for="tonePreference">Tone Preference:</label><input type="text" id="tonePreference" name="tonePreference"></div>
          <div class="modal-form-group"><label for="learningStyle">Learning Style:</label><input type="text" id="learningStyle" name="learningStyle"></div>
          <div class="modal-form-group"><label for="interests">Interests (comma-separated):</label><input type="text" id="interests" name="interests"></div>
        </form>
      </div>

      <div class="modal-section">
        <h3>IEP Plan Accommodations</h3>
        <form id="studentIepForm">
          <div class="modal-form-group checkbox-group">
            <label><input type="checkbox" id="extendedTime" name="extendedTime"> Extended Time</label>
            <label><input type="checkbox" id="simplifiedInstructions" name="simplifiedInstructions"> Simplified Instructions</label>
            <label><input type="checkbox" id="frequentCheckIns" name="frequentCheckIns"> Frequent Check-ins</label>
            <label><input type="checkbox" id="visualSupport" name="visualSupport"> Visual Support</label>
            <label><input type="checkbox" id="chunking" name="chunking"> Chunking Information</label>
            <label><input type="checkbox" id="reducedDistraction" name="reducedDistraction"> Reduced Distraction</label>
            <label><input type="checkbox" id="mathAnxiety" name="mathAnxiety"> Math Anxiety</label>
          </div>
          <div class="modal-form-group"><label for="readingLevel">Reading Level (Grade):</label><input type="number" id="readingLevel" name="readingLevel" min="0" max="12" step="0.5"></div>
          <div class="modal-form-group"><label for="preferredScaffolds">Preferred Scaffolds (comma-separated):</label><input type="text" id="preferredScaffolds" name="preferredScaffolds"></div>
          <div class="modal-form-group" id="iepGoalsDisplay"><label>IEP Goals:</label><div id="iepGoalsList"></div></div>
        </form>
      </div>

      <div class="modal-section">
        <h3>Usage Statistics</h3>
        <div class="info-display-group"><strong>Total Tutoring Minutes:</strong> <span id="totalActiveTutoringMinutes"></span></div>
        <div class="info-display-group"><strong>Weekly Tutoring Minutes:</strong> <span id="weeklyActiveTutoringMinutes"></span></div>
        <div class="info-display-group"><strong>XP:</strong> <span id="xpDisplay"></span></div>
        <div class="info-display-group"><strong>Level:</strong> <span id="levelDisplay"></span></div>
        <div class="info-display-group"><strong>Last Login:</strong> <span id="lastLoginDisplay"></span></div>
        <div class="info-display-group"><strong>Account Created:</strong> <span id="createdAtDisplay"></span></div>
      </div>

      <div class="modal-section">
        <h3>Recent Conversation Summaries</h3>
        <div id="conversationSummariesList" class="conversation-list"></div>
      </div>

      <div class="modal-actions">
        <button class="save-button btn-primary" id="saveChangesButton">Save Changes</button>
        <button class="cancel-button btn-tertiary" id="cancelButton">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Usage Report Modal -->
  <div id="usageReportModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 1200px; max-height: 90vh; overflow-y: auto;">
      <button class="modal-close-button" id="closeUsageReportBtn">&times;</button>
      <h2><i class="fas fa-chart-bar"></i> Usage Report</h2>

      <!-- Filters -->
      <div class="modal-section">
        <h3>Filters</h3>
        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
          <div class="modal-form-group">
            <label for="reportRoleFilter">Role:</label>
            <select id="reportRoleFilter">
              <option value="">All</option>
              <option value="student">Students</option>
              <option value="teacher">Teachers</option>
              <option value="parent">Parents</option>
              <option value="admin">Admins</option>
            </select>
          </div>
          <div class="modal-form-group">
            <label for="reportSortBy">Sort By:</label>
            <select id="reportSortBy">
              <option value="lastLogin">Last Login</option>
              <option value="totalMinutes">Total Minutes</option>
              <option value="weeklyMinutes">Weekly Minutes</option>
              <option value="name">Name</option>
            </select>
          </div>
          <div class="modal-form-group">
            <label for="reportSortOrder">Order:</label>
            <select id="reportSortOrder">
              <option value="desc">Descending</option>
              <option value="asc">Ascending</option>
            </select>
          </div>
          <div class="modal-form-group">
            <button id="applyReportFilters" class="btn-primary" style="align-self: flex-end;">
              <i class="fas fa-filter"></i> Apply Filters
            </button>
            <button id="exportReportCSV" class="btn-secondary" style="align-self: flex-end; margin-left: 10px;">
              <i class="fas fa-download"></i> Export CSV
            </button>
          </div>
        </div>
      </div>

      <!-- Summary Stats -->
      <div class="modal-section">
        <h3>Summary Statistics</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
          <div class="stat-card">
            <div class="stat-label">Total Users</div>
            <div class="stat-value" id="summaryTotalUsers">-</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Active Today</div>
            <div class="stat-value" id="summaryActiveToday">-</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Active This Week</div>
            <div class="stat-value" id="summaryActiveWeek">-</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Total Minutes (All Time)</div>
            <div class="stat-value" id="summaryTotalMinutes">-</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Total Minutes (This Week)</div>
            <div class="stat-value" id="summaryWeekMinutes">-</div>
          </div>
          <div class="stat-card">
            <div class="stat-label">Avg Minutes/User</div>
            <div class="stat-value" id="summaryAvgMinutes">-</div>
          </div>
        </div>
      </div>

      <!-- User Activity Table -->
      <div class="modal-section">
        <h3>User Activity</h3>
        <div class="table-scroll-container" style="max-height: 400px;">
          <table class="user-table">
            <thead>
              <tr>
                <th>Name</th>
                <th>Role</th>
                <th>Last Login</th>
                <th>Total Min</th>
                <th>Weekly Min</th>
                <th>Sessions</th>
                <th>Level</th>
                <th>XP</th>
                <th>Teacher</th>
              </tr>
            </thead>
            <tbody id="usageReportTableBody">
              <tr><td colspan="9" style="text-align: center;">Loading...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- Live Activity Modal -->
  <div id="liveActivityModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 1000px;">
      <button class="modal-close-button" id="closeLiveActivityBtn">&times;</button>
      <h2><i class="fas fa-broadcast-tower"></i> Live Activity Feed</h2>
      <p style="color: #666; margin-bottom: 20px;">
        <i class="fas fa-clock"></i> Showing sessions active in the last 10 minutes
        <button id="refreshLiveActivityBtn" class="btn-secondary" style="float: right;">
          <i class="fas fa-sync-alt"></i> Refresh
        </button>
      </p>

      <div class="modal-section">
        <div id="liveActivityContainer">
          <p style="text-align: center;">Loading...</p>
        </div>
      </div>
    </div>
  </div>

  <!-- User Summaries Modal -->
  <div id="summariesModal" class="modal-overlay">
    <div class="modal-content" style="max-width: 1200px; max-height: 90vh; overflow-y: auto;">
      <button class="modal-close-button" id="closeSummariesBtn">&times;</button>
      <h2><i class="fas fa-list-alt"></i> User Summaries</h2>
      <p style="color: #666; margin-bottom: 20px;">
        <i class="fas fa-users"></i> Showing all users with recent conversation summaries
        <button id="refreshSummariesBtn" class="btn-secondary" style="float: right;">
          <i class="fas fa-sync-alt"></i> Refresh
        </button>
      </p>

      <!-- Filters -->
      <div class="modal-section">
        <h3>Filters</h3>
        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
          <div class="modal-form-group">
            <label for="summariesRoleFilter">Role:</label>
            <select id="summariesRoleFilter">
              <option value="">All</option>
              <option value="student">Students</option>
              <option value="teacher">Teachers</option>
              <option value="parent">Parents</option>
            </select>
          </div>
          <div class="modal-form-group">
            <label for="summariesSearchInput">Search:</label>
            <input type="text" id="summariesSearchInput" placeholder="Search by name or email...">
          </div>
          <div class="modal-form-group">
            <button id="applySummariesFilters" class="btn-primary" style="align-self: flex-end;">
              <i class="fas fa-filter"></i> Apply Filters
            </button>
          </div>
        </div>
      </div>

      <!-- User Summaries List -->
      <div class="modal-section">
        <h3>User Summaries (<span id="summariesCount">0</span>)</h3>
        <div id="summariesContainer">
          <p style="text-align: center;">Loading...</p>
        </div>
      </div>
    </div>
  </div>

  <script src="/js/logout.js"></script>
  <script src="/js/admin-dashboard.js"></script>
</body>
</html>