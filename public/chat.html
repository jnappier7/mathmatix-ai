<!DOCTYPE html> 
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>M∆THM∆TIΧ AI Chat</title>
  <link rel="stylesheet" href="/style.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lottie-web/5.10.1/lottie.min.js"></script>

  <link rel="stylesheet" href="/vendor/mathlive/mathlive-static.css">
  <link rel="stylesheet" href="/vendor/mathlive/mathlive-fonts.css">
  
  <script defer src="/vendor/mathlive/mathlive.min.js"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script>
    window.MathJax = {
        tex: { inlineMath: [['$', '$'], ['\\(', '\\)']], displayMath: [['$$', '$$'], ['\\[', '\\]']] },
        svg: { fontCache: 'global' },
        options: { ignoreHtmlClass: 'tex2jax_ignore', processHtmlClass: 'tex2jax_process' },
        loader: { load: ['input/tex', 'output/svg', '[tex]/physics'] },
        // [NEW] MathJax font configuration for self-hosted fonts (from MathLive package)
        chtml: {
            fontURL: '/vendor/mathlive/fonts' // Assumes MathLive fonts are in public/vendor/mathlive/fonts
        },
        startup: { 
            ready: () => {
                console.log("✅ MathJax is fully loaded.");
                window.isMathJaxReady = true;
            }
        }
    };
  </script>
</head>
<body>
  <div id="app-layout-wrapper">
    <div class="admin-main-content">
    <div class="widget-sidebar-left">
      <div id="leaderboard-content">
        <div class="popup-header"><h2>Leaderboard</h2></div>
        <div class="overflow-y-auto">
          <table id="leaderboardTable">
            <thead><tr><th>Rank</th><th>Student</th><th>Level</th><th>XP</th></tr></thead>
            <tbody></tbody>
          </table>
        </div>
      </div>
      <div id="course-cards-container" class="course-card-wrapper"></div>
    </div>

    <div id="chat-tabs-wrapper">
        <div id="mode-tabs" class="tab-bar">
            <button class="tab-button active" data-tab="chat-pane">💬 Chat</button>
            <button class="tab-button" data-tab="lessons-pane">📘 Lessons</button>
            <button class="tab-button" data-tab="progress-pane">📊 Progress</button>
            <button class="tab-button" data-tab="badges-pane">🏆 Badges</button>
            <button class="tab-button" data-tab="settings-pane">⚙️ Settings</button>
        </div>

        <div id="chat-pane" class="tab-content" style="display: block;">
            <div id="top-bar">
                <img id="logo" src="/MathMatix AI Logo.png" alt="Mathmatix Logo" />
                <button id="logoutBtn" class="logout-button">Log Out</button>
            </div>
            <div id="lesson-header" style="display:none;"></div>
            <div id="chat-container-inner"></div> 
            <div id="thinking-indicator" style="display: none;">
                <span class="dot"></span><span class="dot"></span><span class="dot"></span>
                <span class="thinking-text">Mathmatix is thinking...</span>
            </div>
            <div id="input-container">
                <textarea id="user-input" placeholder="Type your message here…"></textarea>
                <button id="send-button">Send</button>
                <div id="tools-left">
                    <button id="insert-equation" title="Insert Equation"><img src="/equation-icon.png" alt="Insert Equation" /></button>
                </div>
                <div id="tools-right">
                    <button id="mic-button" title="Voice Input"><img src="/mic-icon.png" alt="Mic" /></button>
                    <button id="attach-button" title="Upload File"><img src="/clip-icon.png" alt="Attach" /></button>
                    <input type="file" id="file-input" style="display:none;" />
                </div>
            </div>
            <div id="handsfree-toggle-wrapper">
                <span id="handsfree-label">Hands-Free Mode: OFF</span>
                <button id="handsfree-toggle" class="green"></button>
                <button id="audio-stop-button" title="Stop Speaking" style="display:none;">🔇</button>
            </div>
        </div>

        <div id="lessons-pane" class="tab-content" style="display: none;">
            <h2>📘 Guided Path Lessons</h2>
            <p>Welcome to your lessons. Select a topic to begin or resume.</p>
            <div id="lesson-header" style="display: none;"></div>
            <div id="lesson-content-placeholder">👈 Chat with your tutor to get started, or select a course from the sidebar.</div>
            </div>

        <div id="progress-pane" class="tab-content" style="display: none;">
            <h2>📊 Progress</h2>
            <div id="progress-summary">Loading XP and milestones...</div>
            </div>

        <div id="badges-pane" class="tab-content" style="display: none;">
            <h2>🏆 Badges</h2>
            <div id="badge-collection">No badges yet. Letâ€™s earn some!</div>
            </div>

        <div id="settings-pane" class="tab-content" style="display: none;">
            <h2>⚙️ User Settings</h2>
            <form>
                <label for="tutor-select">Preferred Tutor:</label>
                <select id="tutor-select" class="form-control">
                    </select>

                <label for="tone-select">Voice Tone:</label>
                <select id="tone-select" class="form-control">
                    <option value="encouraging">Encouraging</option>
                    <option value="no-nonsense">No-nonsense</option>
                    <option value="friendly">Friendly</option>
                    <option value="professional">Professional</option>
                    <option value="calm">Calm</option>
                </select>

                <label for="style-select">Learning Style:</label>
                <select id="style-select" class="form-control">
                    <option value="visual">Visual</option>
                    <option value="verbal">Verbal</option>
                    <option value="step">Step-by-Step</option>
                </select>

                <label for="voice-mode-enabled">Enable Voice Input (Hands-Free):</label>
                <input type="checkbox" id="voice-mode-enabled">

                <button type="submit" class="submit-btn" id="save-settings-btn">Save Settings</button>
            </form>
            <p style="margin-top: 20px; text-align: center;"><button id="export-history-btn" class="submit-btn" style="background-color: #6c757d;">Export Chat History</button></p>
            <p style="margin-top: 10px; text-align: center;"><button id="logout-settings-btn" class="submit-btn logout-button">Log Out</button></p>
        </div>
    </div>
    <div class="widget-sidebar-right">
      <div id="xp-level-display">
        <span id="level-badge">Level <span id="current-level">1</span></span>
        <span id="xp-text"><span id="current-xp">0</span> / <span id="xp-needed">100</span> XP</span>
      </div>
      <div id="student-parent-link-display" class="widget-section" style="display: none;">
         <p style="margin-bottom: 5px; font-weight: bold;">Your Parent Link Code:</p>
         <span id="student-link-code-value" style="display: block; background-color: #e6f7ff; padding: 8px; border-radius: 5px; text-align: center; font-size: 1.1em;"></span>
         <p style="margin-top: 5px; font-size: 0.8em; color: #666;">Share this with your parent to link accounts.</p>
      </div> <div id="avatar-container" class="clickable-avatar">
        <div id="student-avatar"></div> 
      </div>
    </div>
    </div>
  </div>

  <footer>
    <p>© 2025 M∆THM∆TIΧ AI. All rights reserved.</p>
    <p><a href="/privacy.html">Privacy Policy</a> | <a href="/terms.html">Terms of Use</a></p>
  </footer>

  <div id="equation-popup" class="modal-overlay popup-resizable-draggable" style="display:none;">
    <div class="modal-content-draggable">
      <div class="modal-header-draggable" id="math-modal-header">
        <h2>Insert Equation</h2>
        <button class="close-button" id="close-equation-popup">&times;</button>
      </div>
      <math-field id="math-editor"></math-field>
      <div class="math-controls">
        <button id="insert-latex" class="submit-btn">Insert</button>
      </div>
      <div class="resize-handle top-left" data-handle="tl"></div>
      <div class="resize-handle top-right" data-handle="tr"></div>
      <div class="resize-handle bottom-left" data-handle="bl"></div>
      <div class="resize-handle bottom-right" data-handle="br"></div>
      <div class="resize-handle top" data-handle="t"></div>
      <div class="resize-handle bottom" data-handle="b"></div>
      <div class="resize-handle left" data-handle="l"></div>
      <div class="resize-handle right" data-handle="r"></div>
    </div>
  </div>

  <div id="switch-tutor-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
      <span id="close-tutor-modal-btn" class="modal-close-button">&times;</span>
      <h2>Choose Your Tutor</h2>
      <p class="subtitle">Select your preferred AI math coach. Your choice changes their voice and style!</p>
      <div id="tutor-options-grid">
        </div>
      <div class="modal-actions">
        <button id="cancel-switch-tutor" class="cancel-button">Cancel</button>
      </div>
    </div>
  </div>

  <script src="/js/tutorConfig.js"></script>
  <script src="/js/script.js"></script>
  <script type="module" src="/js/guidedPath.js"></script>
</body>
</html>